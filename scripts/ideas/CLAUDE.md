# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Build Commands

```bash
# Build CLI (release)
cd icli && cargo build --release

# Build TUI (release)
cd ideas-tui && cargo build --release

# Development (run without building release)
cd icli && cargo run -- <command>
cd ideas-tui && cargo run
```

No test suite - projects are integration-focused against real filesystem data.

## CLI Reference (icli)

```bash
icli ideas [-s active|dormant|unknown] [-q search]  # Browse ideas
icli projects [-c category] [-q search] [--group]   # Browse projects
icli plans [-q search]                               # Browse Claude plans
icli search <query>                                  # Cross-source search
icli stats                                           # Portfolio statistics
icli status                                          # Health check (untracked, stale, recent)
icli dirty [--stale-only]                           # Projects needing (re-)analysis
icli analyze <project> [--deep] [--force]           # Generate analysis (--deep uses Claude CLI)
icli context <project>                              # Output analysis markdown
icli summary <project>                              # Quick analysis preview
icli snapshot [-o path]                             # Create NotebookLM zip bundle
icli refresh                                        # Regenerate project inventory
icli dotfiles [-c category]                         # List DX tools/configs
```

## TUI Reference (ideas-tui)

- `Tab` - Switch between Ideas/Projects tabs
- `j/k` - Navigate list
- `Enter` - Open detail view (Ideas) or analysis preview (Projects)
- `s` - Cycle sort order
- `f` - Cycle status filter (Ideas tab)
- `/` - Search mode
- `o` - Open folder in Finder
- `e` - Open README in $EDITOR
- `q` - Quit

## Architecture

### Data Flow

```
~/Developer/ideas/
├── _tracker.csv           <- Ideas metadata (parsed by icli/ideas-tui)
├── _data/
│   ├── project-inventory.json  <- Generated by mq/projects-scan.sh
│   └── analysis/
│       ├── _meta.json     <- Tracks analyzed_at + commit per project
│       └── *.md           <- Per-project analysis files
└── <idea-folder>/
    └── README.md          <- Status: field parsed via `mq .`
```

### Source Directories Scanned
- `~/Developer/` - Main projects
- `~/src/tries/` - Experiments
- `~/Developer/ideas/` - Ideas repo itself

### Project Categories (auto-detected)
roguelike, writing, ai_tools, mcp, knowledge, simulation, worldbuilding, crt, tui, cli, minecraft, web, tarot, personal, misc

### Module Structure

**icli** (1,768 LOC):
- `src/main.rs` - CLI commands via clap, rendering with colored/termimad
- `src/data.rs` - Data loading (ideas from CSV, projects from JSON, plans from ~/.claude/plans)

**ideas-tui** (1,461 LOC):
- `src/main.rs` - Terminal setup with crossterm
- `src/app.rs` - State management, key handling
- `src/data.rs` - Data structures (shared patterns with icli)
- `src/ui.rs` - Ratatui rendering

**mq scripts**:
- `projects-scan.sh` - Generates project-inventory.json (tech detection, git info, categorization)
- `analyze-project.sh` - Scaffold analysis markdown
- `analyze-project-deep.sh` - Uses Claude CLI for enriched analysis

### External Dependencies
- `mq` - Markdown query CLI (extracts Status: from READMEs, titles from plans)
- `jq` - JSON processing (used by bash scripts)
- Git - Commit counting, dirty detection

### Analysis System

Projects are tracked via `_data/analysis/_meta.json`:
```json
{
  "projects": {
    "project-name": {
      "analyzed_at": "2025-01-15T10:30:00",
      "analyzed_commit": "abc1234"
    }
  }
}
```

`icli dirty` compares current HEAD to analyzed_commit to detect stale analyses.

## Key Patterns

1. **Data Loading**: All data functions in `data.rs` return `Result<Vec<T>>` using anyhow
2. **Filtering**: Both apps use index-based filtering (filtered_indices vec)
3. **Git Integration**: Direct `git` command spawning via `std::process::Command`
4. **Status Detection**: Ideas status parsed from README.md via `mq . <readme>` command
5. **Tech Detection**: Cargo.toml → rust, package.json → js, go.mod → go, then framework-specific (bevy, ratatui, clap)
